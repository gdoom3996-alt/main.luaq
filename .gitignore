-- LocalScript (StarterGui)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local LP = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-------------------------------------------------
-- ÏÑ§Ï†ïÍ∞í
-------------------------------------------------
local FOV_RADIUS = 120
local AIM_SPEED = 250   -- üî• 10 ~ 300 Ïù¥ÏÉÅ Í∞ÄÎä•
local AIMBOT = false
local WALLCHECK = true

-------------------------------------------------
-- GUI
-------------------------------------------------
local gui = Instance.new("ScreenGui", LP:WaitForChild("PlayerGui"))

-- AIMBOT Î≤ÑÌäº
local aimbotBtn = Instance.new("TextButton", gui)
aimbotBtn.Size = UDim2.new(0,180,0,55)
aimbotBtn.Position = UDim2.new(0.05,0,0.45,0)
aimbotBtn.Text = "AIMBOT : OFF"
aimbotBtn.TextScaled = true
aimbotBtn.BackgroundColor3 = Color3.fromRGB(120,0,0)
aimbotBtn.TextColor3 = Color3.new(1,1,1)

-- WallCheck Î≤ÑÌäº
local wallBtn = Instance.new("TextButton", gui)
wallBtn.Size = UDim2.new(0,180,0,45)
wallBtn.Position = UDim2.new(0.05,0,0.45,60)
wallBtn.Text = "WALLCHECK : ON"
wallBtn.TextScaled = true
wallBtn.BackgroundColor3 = Color3.fromRGB(0,120,0)
wallBtn.TextColor3 = Color3.new(1,1,1)

-------------------------------------------------
-- FOV Ïõê
-------------------------------------------------
local FOV = Drawing.new("Circle")
FOV.Radius = FOV_RADIUS
FOV.Thickness = 2
FOV.NumSides = 64
FOV.Filled = false
FOV.Color = Color3.fromRGB(255,0,0)
FOV.Visible = true

-------------------------------------------------
-- Ïú†Ìã∏ Ìï®Ïàò
-------------------------------------------------
local function wallCheck(head, char)
	if not WALLCHECK then
		return true
	end

	local origin = Camera.CFrame.Position
	local dir = head.Position - origin

	local params = RaycastParams.new()
	params.FilterType = Enum.RaycastFilterType.Blacklist
	params.FilterDescendantsInstances = {LP.Character, char}
	params.IgnoreWater = true

	return Workspace:Raycast(origin, dir, params) == nil
end

local function inFOV(worldPos)
	local screenPos, onScreen = Camera:WorldToViewportPoint(worldPos)
	if not onScreen then return false end

	local center = Vector2.new(
		Camera.ViewportSize.X / 2,
		Camera.ViewportSize.Y / 2
	)

	local dist = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude
	return dist <= FOV_RADIUS, dist
end

-------------------------------------------------
-- ÌÉÄÍ≤ü ÌÉêÏÉâ
-------------------------------------------------
local function getTarget()
	local bestHead = nil
	local bestDist = math.huge

	for _, p in pairs(Players:GetPlayers()) do
		if p ~= LP and p.Character then
			local char = p.Character
			local head = char:FindFirstChild("Head")
			local hum = char:FindFirstChild("Humanoid")

			if head and hum and hum.Health > 0 then
				local ok, dist = inFOV(head.Position)
				if ok and wallCheck(head, char) then
					if dist < bestDist then
						bestDist = dist
						bestHead = head
					end
				end
			end
		end
	end

	return bestHead
end

-------------------------------------------------
-- Î©îÏù∏ Î£®ÌîÑ (ÏÜçÎèÑ Í∏∞Î∞ò ÏóêÏûÑ)
-------------------------------------------------
RunService.RenderStepped:Connect(function(dt)
	FOV.Position = Vector2.new(
		Camera.ViewportSize.X / 2,
		Camera.ViewportSize.Y / 2
	)

	if not AIMBOT then
		FOV.Color = Color3.fromRGB(255,0,0)
		return
	end

	local target = getTarget()
	if target then
		FOV.Color = Color3.fromRGB(0,255,0)

		local targetCF = CFrame.new(
			Camera.CFrame.Position,
			target.Position
		)

		local alpha = math.clamp(AIM_SPEED * dt, 0, 1)
		Camera.CFrame = Camera.CFrame:Lerp(targetCF, alpha)
	else
		FOV.Color = Color3.fromRGB(255,0,0)
	end
end)

-------------------------------------------------
-- Î≤ÑÌäº Ïù¥Î≤§Ìä∏
-------------------------------------------------
aimbotBtn.MouseButton1Click:Connect(function()
	AIMBOT = not AIMBOT
	if AIMBOT then
		aimbotBtn.Text = "AIMBOT : ON"
		aimbotBtn.BackgroundColor3 = Color3.fromRGB(200,0,0)
	else
		aimbotBtn.Text = "AIMBOT : OFF"
		aimbotBtn.BackgroundColor3 = Color3.fromRGB(120,0,0)
	end
end)

wallBtn.MouseButton1Click:Connect(function()
	WALLCHECK = not WALLCHECK
	if WALLCHECK then
		wallBtn.Text = "WALLCHECK : ON"
		wallBtn.BackgroundColor3 = Color3.fromRGB(0,120,0)
	else
		wallBtn.Text = "WALLCHECK : OFF"
		wallBtn.BackgroundColor3 = Color3.fromRGB(120,120,0)
	end
end)
